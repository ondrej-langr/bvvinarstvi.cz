import{aU as te,s as se,f as B,t as L,aV as G,r,Q as ae,a as E,u as ne,aW as oe,aH as re,aX as ie,v as le,aY as ce,ak as ue,m as S,b as de,a9 as $,x as me,j as s,ah as ge,ab as K,aR as fe,h as f,aZ as z,S as he,k as N,a_ as X,a$ as pe,F as be,ai as xe,a6 as ye,b0 as F,a4 as V,ay as we,J as H,A as R,T as Ne,ac as q,b1 as Se,ag as Ce,B as ke,b2 as ve,b3 as Me,b4 as Oe}from"./index.d96b26d5.js";const Y=4e3,Q=async(e,t)=>{const n=te();se({id:n,loading:!0,title:e.title,message:e.message,autoClose:!1,disallowClose:!0});try{const a=await t();return B({id:n,message:e.successMessage||L("Task completed successfully").toString(),autoClose:Y}),a}catch(a){throw B({id:n,color:"red",message:e.errorMessage?typeof e.errorMessage=="function"?e.errorMessage(a):e.errorMessage:L("An error happened").toString(),autoClose:Y}),a}},Ie=e=>{const{singletons:t}=G();return r.exports.useMemo(()=>t&&t[e],[e,t])},b=(e=!1)=>{const{singletonId:t}=ae(),n=r.exports.useMemo(()=>String(t),[t]),a=Ie(n);if(e&&!a)throw new Error("Model not found");return r.exports.useMemo(()=>a?{...a,key:n}:void 0,[n,a])},Pe=(e,t)=>{const n=b(!0),a=r.exports.useCallback(()=>E.singletons.getOne(n.key,e).then(({data:c})=>c.data),[n,e]),l=r.exports.useMemo(()=>[n.key],[n.key]),o=ne([l,e],a,{...t});return r.exports.useMemo(()=>({...o,key:l}),[l,o])},Z=r.exports.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),j=()=>r.exports.useContext(Z),Te=({children:e})=>{var _;const t=oe(),n=re(),a=b(!0),l=r.exports.useMemo(()=>a&&ie(a,!0),[a]),o=le({defaultValues:ce(a),reValidateMode:"onChange",mode:"onTouched",resolver:l&&ue(l)}),{t:c}=S(),[u,k]=r.exports.useState((_=n==null?void 0:n.i18n)==null?void 0:_.default),h=de(),{data:m,isLoading:O,key:v}=Pe({language:u},{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),{handleSubmit:I,setError:P}=o,C=r.exports.useCallback(p=>h.setQueryData(v,p),[v]);r.exports.useEffect(()=>{var p;if(m&&(o.reset({...Object.fromEntries(Object.entries(m).filter(([x,g])=>g!==null)),...m.content?{content:JSON.stringify(m.content)}:{}}),t.refs.current))for(const[x,g]of Object.entries(t.refs.current))m[x]&&((p=g==null?void 0:g.blocks)==null||p.render(m[x]))},[m,o]);const i=I(async p=>{var g,w,D;const x=a.key;if(t.refs.current)for(const[y,d]of Object.entries(t.refs.current))await(d==null?void 0:d.isReady),d&&"save"in d&&(p[y]=JSON.stringify(await d.save()));try{await Q({title:"Updating",message:c("Updating your entry, please wait..."),successMessage:c("Your entry is updated!")},async()=>{const y=$(m,p),{data:{data:d}}=await E.singletons.update(x,y,{language:u});C(d)})}catch(y){if(me.isAxiosError(y)&&((w=(g=y.response)==null?void 0:g.data)==null?void 0:w.code)===900409){const d=y.response.data.data;if(Array.isArray(d)&&d.length)for(const T of d){const M=(D=a==null?void 0:a.columns)==null?void 0:D.get(T);let U=T;T==="slug"&&(M==null?void 0:M.type)==="slug"&&(U=M.of),P(U,{message:c("This field is unique and other entry has the same value")})}}}}),A=r.exports.useCallback(async()=>Q({message:c("Clearing singleton..."),title:c("Clearing"),errorMessage:c("Failed to clear"),successMessage:c("Clearing successful!")},async()=>{var x,g;const{data:{data:p}}=await E.singletons.clear(a==null?void 0:a.key);if(t.refs.current)for(const w of Object.values(t.refs.current))(g=w==null?void 0:(x=w.blocks).clear)==null||g.call(x);o.reset(p),C(p)}),[C,a,c,t,o.reset]),ee=r.exports.useMemo(()=>({language:u,setLanguage:k,data:m,isLoading:O,clear:A}),[u,k,A]);return s(ge,{...o,children:s(Z.Provider,{value:ee,children:s("form",{className:"flex",onSubmit:i,children:e})})})},Fe=()=>{var l;const{t:e}=S(),{language:t,setLanguage:n}=j(),{settings:a}=G();return((l=a==null?void 0:a.i18n.languages.length)!=null?l:0)<=1?null:s(K,{title:e("Internationalization"),children:s("div",{className:"mx-5 mb-5",children:s(fe,{value:t,onChange:o=>o&&n(o),className:"w-full",shadow:"xl"})})})},W=({className:e,...t})=>s(he,{className:N("relative top-0.5 inline-block h-4",e),...t}),J="D.M. YYYY, HH:mm",Ee=()=>{const{data:e,isLoading:t}=j(),{t:n}=S(),a=b();return a!=null&&a.hasTimestamps?s(K,{className:"!pt-0",title:n("Publish info"),children:s("div",{className:"w-full px-4 py-5",children:f("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[f("li",{children:[n("Updated at:")," ",t?s(W,{className:"w-full max-w-[6rem]"}):s("span",{className:"font-semibold text-blue-600",children:e!=null&&e.updated_at?z(e.updated_at).format(J):n("Not edited yet")})]}),!!(e!=null&&e.created_at)&&f("li",{children:[n("Created at:")," ",t?s(W,{className:"w-full max-w-[6rem]"}):s("span",{className:"font-semibold text-blue-600",children:z(e.created_at).format(J)})]})]})})}):null},je=()=>{const e=b(!0),{isOpen:t}=X();return s("aside",{className:N("sticky top-0 z-10 transition-[width] duration-300",t?"w-[500px]":"h-0 w-0 overflow-hidden"),children:f("div",{className:N("h-full w-[500px] py-5 pl-8 flex flex-col gap-5"),children:[s(Ee,{}),s(Fe,{}),s(pe,{model:e})]})})},Ae=()=>{const{t:e}=S(),t=b(!0);return s(be,{children:s(xe,{className:"py-5",items:[{content:e("Singletons")},{content:s("p",{className:"flex-none text-green-500 underline",children:e(t.name)})}]})})},_e=()=>{const{name:e,columns:t}=b(!0),{t:n}=S();return r.exports.useMemo(()=>t&&!!Object.entries(Object.fromEntries(t)).find(([l,o])=>!o.hide&&o.editable&&o.admin.editor.placement===ye.MAIN&&o.type==="string"&&o.admin.fieldType==="heading"),[t])?null:f(F,{children:[f(F.Title,{children:[n("Update")," ",e]}),s(F.Divider,{})]})},De=()=>{const{watch:e}=V(),t=e(),{t:n}=S(),{isOpen:a,setIsOpen:l}=X(),{data:o,clear:c}=j(),u=b(),{setValue:k,formState:h}=V(),m=r.exports.useMemo(()=>!!Object.keys($(o||{},t)).length,[t,o]),O=async()=>{confirm(n(Ce.ON_DELETE_REQUEST_PROMPT))&&await c()},v=()=>{},I=r.exports.useMemo(()=>{let i="";return h.isSubmitting?i="Updating":i="Update",n(i)},[h.isSubmitting,n]),P=r.exports.useMemo(()=>{let i="";return!(u!=null&&u.isDraftable)||!o?i:(o.is_published?i="Unpublish":i="Publish",n(i))},[o,h.isSubmitting,u,n]),C=()=>{k("is_published",o?!o.is_published:!1)};return f(we,{shadow:"lg",component:"footer",className:"align-center container sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between border-2 border-project-border p-3",children:[s(H,{withArrow:!0,label:n("Clean data"),position:"top",color:"gray",children:s(R,{size:"xl",type:"button",loading:h.isSubmitting,onClick:O,color:"red",variant:"light",styles:{root:{width:50,height:50}},className:N(h.isSubmitting&&"!cursor-progress"),children:s(Ne,{className:"aspect-square w-10"})})}),f("div",{className:"flex items-center gap-3",children:[(u==null?void 0:u.isDraftable)&&s(q,{size:"sm",variant:"white",type:"submit",disabled:h.isSubmitting,className:"ml-auto",onClick:C,px:"sm",children:P}),s(q,{size:"lg",color:"green",type:"submit",disabled:!m,loading:h.isSubmitting,onClick:v,children:I}),s(H,{withArrow:!0,label:n("Toggle more options"),position:"top",color:"gray",children:s(R,{size:"xl",color:"blue",variant:"light",type:"button",className:N(h.isSubmitting&&"!cursor-progress"),styles:{root:{width:50,height:50}},onClick:()=>l(i=>!i),children:s(Se,{className:N("aspect-square w-20 duration-150",a&&"rotate-180")})})})]})]})},Ue=()=>{const e=b(!0);return s(Oe,{modelInfo:e})},Le=({})=>b()?f(Te,{children:[f(ve,{children:[s(Ae,{}),f(Me,{children:[s(_e,{}),s(Ue,{}),s(De,{})]})]}),s(je,{})]}):s(ke,{});export{Le as default};
