import{aS as te,s as se,f as B,t as L,aT as J,r,Q as ae,a as E,u as ne,aU as oe,aG as re,aV as ie,v as le,aW as ce,ag as ue,m as S,b as de,a9 as $,x as me,j as t,aj as ge,aa as K,aP as pe,h as m,aX as z,S as fe,k as w,aY as X,aZ as he,F as be,ak as xe,a6 as ye,a_ as F,a4 as V,ax as we,J as R,A as q,T as Se,ab as H,a$ as Ne,af as Ce,B as ke,b0 as ve,b1 as Me,b2 as Oe}from"./index.7b0c7ee9.js";const Y=4e3,Q=async(e,a)=>{const n=te();se({id:n,loading:!0,title:e.title,message:e.message,autoClose:!1,disallowClose:!0});try{const s=await a();return B({id:n,message:e.successMessage||L("Task completed successfully").toString(),autoClose:Y}),s}catch(s){throw B({id:n,color:"red",message:e.errorMessage?typeof e.errorMessage=="function"?e.errorMessage(s):e.errorMessage:L("An error happened").toString(),autoClose:Y}),s}},Pe=e=>{const{singletons:a}=J();return r.exports.useMemo(()=>a&&a[e],[e,a])},f=(e=!1)=>{const{singletonId:a}=ae(),n=r.exports.useMemo(()=>String(a),[a]),s=Pe(n);if(e&&!s)throw new Error("Model not found");return r.exports.useMemo(()=>s?{...s,key:n}:void 0,[n,s])},Te=(e,a)=>{const n=f(!0),s=r.exports.useCallback(()=>E.singletons.getOne(n.key,e).then(({data:c})=>c.data),[n,e]),l=r.exports.useMemo(()=>[n.key],[n.key]),o=ne([l,e],s,{...a});return r.exports.useMemo(()=>({...o,key:l}),[l,o])},Z=r.exports.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),j=()=>r.exports.useContext(Z),Ie=({children:e})=>{var _;const a=oe(),n=re(),s=f(!0),l=r.exports.useMemo(()=>s&&ie(s,!0),[s]),o=le({defaultValues:ce(s),reValidateMode:"onChange",mode:"onTouched",resolver:l&&ue(l)}),{t:c}=S(),[d,k]=r.exports.useState((_=n==null?void 0:n.i18n)==null?void 0:_.default),g=de(),{data:p,isLoading:O,key:v}=Te(void 0,{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),{handleSubmit:P,setError:T}=o,N=r.exports.useCallback(h=>g.setQueryData(v,h),[v]);r.exports.useEffect(()=>{p&&o.reset({...Object.fromEntries(Object.entries(p).filter(([h,x])=>x!==null)),...p.content?{content:JSON.stringify(p.content)}:{}})},[p,o]);const i=P(async h=>{var C,y,D;const x=s.key;if(a.refs.current)for(const[b,u]of Object.entries(a.refs.current))await(u==null?void 0:u.isReady),u&&"save"in u&&(h[b]=JSON.stringify(await u.save()));try{await Q({title:"Updating",message:c("Updating your entry, please wait..."),successMessage:c("Your entry is updated!")},async()=>{const b=$(p,h),{data:{data:u}}=await E.singletons.update(x,b,{language:d});N(u)})}catch(b){if(me.isAxiosError(b)&&((y=(C=b.response)==null?void 0:C.data)==null?void 0:y.code)===900409){const u=b.response.data.data;if(Array.isArray(u)&&u.length)for(const I of u){const M=(D=s==null?void 0:s.columns)==null?void 0:D.get(I);let U=I;I==="slug"&&(M==null?void 0:M.type)==="slug"&&(U=M.of),T(U,{message:c("This field is unique and other entry has the same value")})}}}}),A=r.exports.useCallback(async()=>Q({message:c("Clearing singleton..."),title:c("Clearing"),errorMessage:c("Failed to clear"),successMessage:c("Clearing successful!")},async()=>{var x,C;const{data:{data:h}}=await E.singletons.clear(s==null?void 0:s.key);if(a.refs.current)for(const y of Object.values(a.refs.current))(C=y==null?void 0:(x=y.blocks).clear)==null||C.call(x);o.reset(h),N(h)}),[N,s,c,a,o.reset]),ee=r.exports.useMemo(()=>({language:d,setLanguage:k,data:p,isLoading:O,clear:A}),[d,k,A]);return t(ge,{...o,children:t(Z.Provider,{value:ee,children:t("form",{className:"flex",onSubmit:i,children:e})})})},Fe=()=>{var l;const{t:e}=S(),{language:a,setLanguage:n}=j(),{settings:s}=J();return((l=s==null?void 0:s.i18n.languages.length)!=null?l:0)<=1?null:t(K,{title:e("Internationalization"),children:t("div",{className:"mx-5 mb-5",children:t(pe,{value:a,onChange:o=>o&&n(o),className:"w-full",shadow:"xl"})})})},W=({className:e,...a})=>t(fe,{className:w("relative top-0.5 inline-block h-4",e),...a}),G="D.M. YYYY, HH:mm",Ee=()=>{const{data:e,isLoading:a}=j(),{t:n}=S(),s=f();return s!=null&&s.hasTimestamps?t(K,{className:"!pt-0",title:n("Publish info"),children:t("div",{className:"w-full px-4 py-5",children:m("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[m("li",{children:[n("Updated at:")," ",a?t(W,{className:"w-full max-w-[6rem]"}):t("span",{className:"font-semibold text-blue-600",children:e!=null&&e.updated_at?z(e.updated_at).format(G):n("Not edited yet")})]}),!!(e!=null&&e.created_at)&&m("li",{children:[n("Created at:")," ",a?t(W,{className:"w-full max-w-[6rem]"}):t("span",{className:"font-semibold text-blue-600",children:z(e.created_at).format(G)})]})]})})}):null},je=()=>{const e=f(!0),{isOpen:a}=X();return t("aside",{className:w("sticky top-0 z-10 transition-[width] duration-300","flex flex-col gap-5",a?"w-[500px]":"h-0 w-0 overflow-hidden"),children:m("div",{className:w("h-full w-[500px] py-5 pl-8"),children:[t(Ee,{}),t(Fe,{}),t(he,{model:e})]})})},Ae=()=>{const{t:e}=S(),a=f(!0);return t(be,{children:t(xe,{className:"py-5",items:[{content:e("Singletons")},{content:t("p",{className:"flex-none text-green-500 underline",children:e(a.name)})}]})})},_e=()=>{const{name:e,columns:a}=f(!0),{t:n}=S();return r.exports.useMemo(()=>a&&!!Object.entries(Object.fromEntries(a)).find(([l,o])=>!o.hide&&o.editable&&o.admin.editor.placement===ye.MAIN&&o.type==="string"&&o.admin.fieldType==="heading"),[a])?null:m(F,{children:[m(F.Title,{children:[n("Update")," ",e]}),t(F.Divider,{})]})},De=()=>{const{watch:e}=V(),a=e(),{t:n}=S(),{isOpen:s,setIsOpen:l}=X(),{data:o,clear:c}=j(),d=f(),{setValue:k,formState:g}=V(),p=r.exports.useMemo(()=>!!Object.keys($(o||{},a)).length,[a,o]),O=async()=>{confirm(n(Ce.ON_DELETE_REQUEST_PROMPT))&&await c()},v=()=>{},P=r.exports.useMemo(()=>{let i="";return g.isSubmitting?i="Updating":i="Update",n(i)},[g.isSubmitting,n]),T=r.exports.useMemo(()=>{let i="";return!(d!=null&&d.isDraftable)||!o?i:(o.is_published?i="Unpublish":i="Publish",n(i))},[o,g.isSubmitting,d,n]),N=()=>{k("is_published",o?!o.is_published:!1)};return m(we,{shadow:"lg",component:"footer",className:"align-center container sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between border-2 border-project-border p-3",children:[t(R,{withArrow:!0,label:n("Clean data"),position:"top",color:"gray",children:t(q,{size:"xl",type:"button",loading:g.isSubmitting,onClick:O,color:"red",variant:"light",styles:{root:{width:50,height:50}},className:w(g.isSubmitting&&"!cursor-progress"),children:t(Se,{className:"aspect-square w-10"})})}),m("div",{className:"flex items-center gap-3",children:[(d==null?void 0:d.isDraftable)&&t(H,{size:"sm",variant:"white",type:"submit",disabled:g.isSubmitting,className:"ml-auto",onClick:N,px:"sm",children:T}),t(H,{size:"lg",color:"green",type:"submit",disabled:!p,loading:g.isSubmitting,onClick:v,children:P}),t(R,{withArrow:!0,label:n("Toggle more options"),position:"top",color:"gray",children:t(q,{size:"xl",color:"blue",variant:"light",type:"button",className:w(g.isSubmitting&&"!cursor-progress"),styles:{root:{width:50,height:50}},onClick:()=>l(i=>!i),children:t(Ne,{className:w("aspect-square w-20 duration-150",s&&"rotate-180")})})})]})]})},Ue=()=>{const e=f(!0);return t(Oe,{modelInfo:e})},Le=({})=>f()?m(Ie,{children:[m(ve,{children:[t(Ae,{}),m(Me,{children:[t(_e,{}),t(Ue,{}),t(De,{})]})]}),t(je,{})]}):t(ke,{});export{Le as default};
