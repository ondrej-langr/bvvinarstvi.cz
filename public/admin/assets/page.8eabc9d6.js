import{aS as te,s as se,f as B,t as L,aT as J,r,Q as ae,a as j,u as ne,aU as oe,aG as re,aV as ie,v as le,aW as ce,ag as ue,m as S,b as de,a9 as $,x as me,j as s,aj as ge,aa as K,aP as fe,h as f,aX as z,S as pe,k as N,aY as X,aZ as he,F as be,ak as xe,a6 as ye,a_ as F,a4 as V,ax as we,J as q,A as H,T as Ne,ab as R,a$ as Se,af as Ce,B as ke,b0 as ve,b1 as Me,b2 as Oe}from"./index.339d4384.js";const Y=4e3,Q=async(e,t)=>{const n=te();se({id:n,loading:!0,title:e.title,message:e.message,autoClose:!1,disallowClose:!0});try{const a=await t();return B({id:n,message:e.successMessage||L("Task completed successfully").toString(),autoClose:Y}),a}catch(a){throw B({id:n,color:"red",message:e.errorMessage?typeof e.errorMessage=="function"?e.errorMessage(a):e.errorMessage:L("An error happened").toString(),autoClose:Y}),a}},Pe=e=>{const{singletons:t}=J();return r.exports.useMemo(()=>t&&t[e],[e,t])},b=(e=!1)=>{const{singletonId:t}=ae(),n=r.exports.useMemo(()=>String(t),[t]),a=Pe(n);if(e&&!a)throw new Error("Model not found");return r.exports.useMemo(()=>a?{...a,key:n}:void 0,[n,a])},Te=(e,t)=>{const n=b(!0),a=r.exports.useCallback(()=>j.singletons.getOne(n.key,e).then(({data:c})=>c.data),[n,e]),l=r.exports.useMemo(()=>[n.key],[n.key]),o=ne([l,e],a,{...t});return r.exports.useMemo(()=>({...o,key:l}),[l,o])},Z=r.exports.createContext({setLanguage:()=>{},isLoading:!0,async clear(){}}),E=()=>r.exports.useContext(Z),Ie=({children:e})=>{var _;const t=oe(),n=re(),a=b(!0),l=r.exports.useMemo(()=>a&&ie(a,!0),[a]),o=le({defaultValues:ce(a),reValidateMode:"onChange",mode:"onTouched",resolver:l&&ue(l)}),{t:c}=S(),[d,k]=r.exports.useState((_=n==null?void 0:n.i18n)==null?void 0:_.default),p=de(),{data:m,isLoading:O,key:v}=Te(void 0,{refetchInterval:0,refetchOnMount:!0,refetchOnReconnect:!1,refetchOnWindowFocus:!1,refetchIntervalInBackground:!1}),{handleSubmit:P,setError:T}=o,C=r.exports.useCallback(h=>p.setQueryData(v,h),[v]);r.exports.useEffect(()=>{var h;if(m&&(o.reset({...Object.fromEntries(Object.entries(m).filter(([x,g])=>g!==null)),...m.content?{content:JSON.stringify(m.content)}:{}}),t.refs.current))for(const[x,g]of Object.entries(t.refs.current))m[x]&&((h=g==null?void 0:g.blocks)==null||h.render(m[x]))},[m,o]);const i=P(async h=>{var g,w,D;const x=a.key;if(t.refs.current)for(const[y,u]of Object.entries(t.refs.current))await(u==null?void 0:u.isReady),u&&"save"in u&&(h[y]=JSON.stringify(await u.save()));try{await Q({title:"Updating",message:c("Updating your entry, please wait..."),successMessage:c("Your entry is updated!")},async()=>{const y=$(m,h),{data:{data:u}}=await j.singletons.update(x,y,{language:d});C(u)})}catch(y){if(me.isAxiosError(y)&&((w=(g=y.response)==null?void 0:g.data)==null?void 0:w.code)===900409){const u=y.response.data.data;if(Array.isArray(u)&&u.length)for(const I of u){const M=(D=a==null?void 0:a.columns)==null?void 0:D.get(I);let U=I;I==="slug"&&(M==null?void 0:M.type)==="slug"&&(U=M.of),T(U,{message:c("This field is unique and other entry has the same value")})}}}}),A=r.exports.useCallback(async()=>Q({message:c("Clearing singleton..."),title:c("Clearing"),errorMessage:c("Failed to clear"),successMessage:c("Clearing successful!")},async()=>{var x,g;const{data:{data:h}}=await j.singletons.clear(a==null?void 0:a.key);if(t.refs.current)for(const w of Object.values(t.refs.current))(g=w==null?void 0:(x=w.blocks).clear)==null||g.call(x);o.reset(h),C(h)}),[C,a,c,t,o.reset]),ee=r.exports.useMemo(()=>({language:d,setLanguage:k,data:m,isLoading:O,clear:A}),[d,k,A]);return s(ge,{...o,children:s(Z.Provider,{value:ee,children:s("form",{className:"flex",onSubmit:i,children:e})})})},Fe=()=>{var l;const{t:e}=S(),{language:t,setLanguage:n}=E(),{settings:a}=J();return((l=a==null?void 0:a.i18n.languages.length)!=null?l:0)<=1?null:s(K,{title:e("Internationalization"),children:s("div",{className:"mx-5 mb-5",children:s(fe,{value:t,onChange:o=>o&&n(o),className:"w-full",shadow:"xl"})})})},W=({className:e,...t})=>s(pe,{className:N("relative top-0.5 inline-block h-4",e),...t}),G="D.M. YYYY, HH:mm",je=()=>{const{data:e,isLoading:t}=E(),{t:n}=S(),a=b();return a!=null&&a.hasTimestamps?s(K,{className:"!pt-0",title:n("Publish info"),children:s("div",{className:"w-full px-4 py-5",children:f("ul",{className:"flex list-disc flex-col gap-2 pl-5",children:[f("li",{children:[n("Updated at:")," ",t?s(W,{className:"w-full max-w-[6rem]"}):s("span",{className:"font-semibold text-blue-600",children:e!=null&&e.updated_at?z(e.updated_at).format(G):n("Not edited yet")})]}),!!(e!=null&&e.created_at)&&f("li",{children:[n("Created at:")," ",t?s(W,{className:"w-full max-w-[6rem]"}):s("span",{className:"font-semibold text-blue-600",children:z(e.created_at).format(G)})]})]})})}):null},Ee=()=>{const e=b(!0),{isOpen:t}=X();return s("aside",{className:N("sticky top-0 z-10 transition-[width] duration-300",t?"w-[500px]":"h-0 w-0 overflow-hidden"),children:f("div",{className:N("h-full w-[500px] py-5 pl-8 flex flex-col gap-5"),children:[s(je,{}),s(Fe,{}),s(he,{model:e})]})})},Ae=()=>{const{t:e}=S(),t=b(!0);return s(be,{children:s(xe,{className:"py-5",items:[{content:e("Singletons")},{content:s("p",{className:"flex-none text-green-500 underline",children:e(t.name)})}]})})},_e=()=>{const{name:e,columns:t}=b(!0),{t:n}=S();return r.exports.useMemo(()=>t&&!!Object.entries(Object.fromEntries(t)).find(([l,o])=>!o.hide&&o.editable&&o.admin.editor.placement===ye.MAIN&&o.type==="string"&&o.admin.fieldType==="heading"),[t])?null:f(F,{children:[f(F.Title,{children:[n("Update")," ",e]}),s(F.Divider,{})]})},De=()=>{const{watch:e}=V(),t=e(),{t:n}=S(),{isOpen:a,setIsOpen:l}=X(),{data:o,clear:c}=E(),d=b(),{setValue:k,formState:p}=V(),m=r.exports.useMemo(()=>!!Object.keys($(o||{},t)).length,[t,o]),O=async()=>{confirm(n(Ce.ON_DELETE_REQUEST_PROMPT))&&await c()},v=()=>{},P=r.exports.useMemo(()=>{let i="";return p.isSubmitting?i="Updating":i="Update",n(i)},[p.isSubmitting,n]),T=r.exports.useMemo(()=>{let i="";return!(d!=null&&d.isDraftable)||!o?i:(o.is_published?i="Unpublish":i="Publish",n(i))},[o,p.isSubmitting,d,n]),C=()=>{k("is_published",o?!o.is_published:!1)};return f(we,{shadow:"lg",component:"footer",className:"align-center container sticky bottom-1 left-0 z-10 mx-auto flex max-h-20 items-center justify-between border-2 border-project-border p-3",children:[s(q,{withArrow:!0,label:n("Clean data"),position:"top",color:"gray",children:s(H,{size:"xl",type:"button",loading:p.isSubmitting,onClick:O,color:"red",variant:"light",styles:{root:{width:50,height:50}},className:N(p.isSubmitting&&"!cursor-progress"),children:s(Ne,{className:"aspect-square w-10"})})}),f("div",{className:"flex items-center gap-3",children:[(d==null?void 0:d.isDraftable)&&s(R,{size:"sm",variant:"white",type:"submit",disabled:p.isSubmitting,className:"ml-auto",onClick:C,px:"sm",children:T}),s(R,{size:"lg",color:"green",type:"submit",disabled:!m,loading:p.isSubmitting,onClick:v,children:P}),s(q,{withArrow:!0,label:n("Toggle more options"),position:"top",color:"gray",children:s(H,{size:"xl",color:"blue",variant:"light",type:"button",className:N(p.isSubmitting&&"!cursor-progress"),styles:{root:{width:50,height:50}},onClick:()=>l(i=>!i),children:s(Se,{className:N("aspect-square w-20 duration-150",a&&"rotate-180")})})})]})]})},Ue=()=>{const e=b(!0);return s(Oe,{modelInfo:e})},Le=({})=>b()?f(Ie,{children:[f(ve,{children:[s(Ae,{}),f(Me,{children:[s(_e,{}),s(Ue,{}),s(De,{})]})]}),s(Ee,{})]}):s(ke,{});export{Le as default};
